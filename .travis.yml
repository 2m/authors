dist: xenial
services:
  - xvfb

language: scala
jdk: openjdk8

jobs:
   include:
     - stage: check
       script: sbt scalafmtCheck || { echo "[error] Unformatted code found. Please run 'Test/compile' and commit the reformatted code."; false; }
       name: "Code style check (fixed with `sbt Test/compile`)"
     - script: sbt scalafmtSbtCheck || { echo "[error] Unformatted sbt code found. Please run 'scalafmtSbt' and commit the reformatted code."; false; }
       name: "Build code style check (fixed with `sbt scalafmtSbt`)"
     - script: sbt "scalafix --check" || { echo "[error] Unformatted code found. Please run 'scalafix' and commit the reformatted code."; false; }
       name: "Code style check (fixed with `sbt scalafix`)"

     - stage: test
       script: sbt test
       name: Run all unit tests
     - script: sbt scripted
       name: Run all sbt scripted tests

     - stage: publish
       script: sbt core/publish core/bintraySyncMavenCentral plugin/publish
       name: Publish artifacts

stages:
  # runs on master commits and PRs
  - name: check
    if: NOT tag =~ ^v

  # runs on master commits and PRs
  - name: test
    if: NOT tag =~ ^v

  # runs on main repo master commits or version-tagged commits
  - name: publish
    if: repo = 2m/authors AND ( ( branch = master AND type = push ) OR tag =~ ^v )

before_cache:
  - find $HOME/.ivy2 -name "ivydata-*.properties" -print -delete
  - find $HOME/.sbt  -name "*.lock"               -print -delete

cache:
  directories:
    - $HOME/.ivy2/cache
    - $HOME/.sbt/boot
    - $HOME/.sbt/launchers

env:
  global:
    # travis encrypt BINTRAY_USER=...
    - secure: "FdrdsHVr8JQXxEuoKTVM51xHaXV9ZjEeE9MzWs06MmyroPP3WcpzmR6tPNIGNuqNcBxHDMyRnYTTGcbIMIkFLS5qx1Ho5uDVofKF+SSDejCmFPm+2uvDnzNkuxXXIruB8q9ePaWldyFybpOw4/YgyOc/BO5s4wZSMd1VkRwQQO+hruIc/MKb1v+p5WxnZ/oD7Dd4hVYoHNVILd1Osf+2pSP3S7hDKzYWKcMjwI7nxirSFRicKIvxB0vl3FIjMOK0QTdO9XR+0f5Xj6+y343461aH52ZOBmmvfBfIJ4+6DeTc4KewJMIJN78Tzfx33KYqycbLcG1J1z5ETSjaeM3IwI5ch5eXcGUTMvbW9lDlUBM53qwCLLsa8SpndOWBsIwNiQtf4ZZpzr/D+23dl5UaWR4yNoLyC4mKNywekeqr3DZe5BIWYfVAl9qJyFnLAkQ3JT4gVU827uBDMb/dPxVm4pBZj3sqQ9VSmU2ay7RrfmXmLtm7cZzvbn2VsPUkaLpeR7TE3e8ogsQrRuShGOd1rIrLCHl7m/QuGQWi0riiVszb78W2TQLVG3wjwZGcAxRNlHM15gupExGZwcgHhDu7z+DvxF10qTEGh7aD+tatVDvw7spnJPxNTNUxDCZaS14kogG4P+5S+5egoxysfozHu3qS+NhBABmpD1aWyKKE8bk="
    # travis encrypt BINTRAY_PASS=...
    - secure: "yKybs1TlCPvuSFIQa/q5vX5mSWGPmYLf4X2u0rYyoci+ckIs3mRG9wjTRr9xM3afhopDRBEo1GtU6O9XWJXTxE1U3SVVeW/CgdtDc30PZL41PrOu45ijcnLKsuadLAK8ZmOIjLojtoUDsaeu9MrV4fLUnknAmpmQd0bjeGP56M2AOA3z1RirAaSey7PYNd2ZVMVCMOKn71jw3a0eXH41PPGv91kpnVf+mYdy4zCtyDGdRuQNp5YLlFmePLmNRp8xfLo3+yPKwob5/dv9bimg/PiRnrfLhEF4NkA/hIK7iiHupw2KwT8+2XJgj049R6SlluDeM9LeA+RQn+TA7YS7f7LKRLI13iiOiZopAlhDeyDtDQc2t4qsCu3FQtBanl1Zp10F0ylhfIU4Pp7lNYQ4przSivd0I64LwVDisFZ0UY75aOaS1HasSGr/F0fCKmiJ9WNU3+e64pBf+Pw1IfkhMx1djxXuZAhnROuNbZhdVboTgxpXcGIUmhudaXj1kcAoaujWWvmPI/eKFJ3Ic/FK7WZvnwu8plHrivxEbBBNI6g5fx/jTSYMK6t7lrur8led0qInt5/H2aKapfWaJORq4FmqBQ+yWQOVauyyRhzD3zYLiAxUsj/Ipq/NUp10NFXQ9URYE9xOIWc+lK4IdBYumyahEkfF8/tCuZi4+91oEgY="
    # travis encrypt SONA_USER=...
    - secure: "x/D4xaxOf48NevMJFby3OBBpFZNgMZcrk/nttH178I8E9Z6ZfHD4u+kAR/at+GCpob3Y4hB5dN+OvKQgG4AFYDwS4OhVTaX3HnbWknZ4F5wKYHUqK0tQ0DmcvvkRWf3YjeZfOM1saQiDCbCLIIQGwgondGExucNIOI9kB7JRKmjnfzs0x0fi/5SiVNqGUm1JFf9oqTgdLtwWhY3CbPO7tjxpuA8tk4De5r2ZYWsyD5aCCYNFeR3LOqlZVj6QDM4SmS5lUnWH9hHwFk2jXqV1SjTlszgHEEO8FNHPdLx6wR8gWmiZgnSpImhgj4HLZbW67hw4WWpCcq6S8KTuMsN2Xs7t98rum5v7CxkIXePtMVpRKFg6lN/p4UWGmqObgT0W/ektnrexgCJEMcPcFTvgxcVxKdR6VpxbUEUvl3H3L8vfxs6fNNSFAR8BNs6Tel3+wMUS7X0ukliuHQ9ykPzwB9YbKKnwiw2Wuo8au3gCOSeHn+DqopBBclq1VXuHZ2AcTjb5BokiEBY9S/VExBLaFOThkOLEjvvUzDG03dmrOyGLlibNZqBj5rk2QKDzbt1T/kzSMqeT8+G7fiLA0pNMBh2rMYuQAd4epSAfIfx3zefBL8W67eSlQ1GSa3Cny5eJ2+/j2PTLgwwgC2nMWpOxd9vIT7LhitDd7UFNG6+AlRQ="
    # travis encrypt SONA_PASS=
    - secure: "vN10+jDmWMTI29UZbLTpmFjKH3hJJ1IVJUxEErGfoh70Yu3kOXVwHddaPLAOe3Pn55++DqvawVq4o8nsCZFo2sejzjw56kI/2Km2pamO6HEua8AulqC2yH8af0LuTKXMs4CmAndpvEloYgolKnc2vIbRo4V2SHD9Z9kVksHgRMwiogFYMzbc09/iFy1K8TbfWZxd2uUZLYUf+kPcBFXHURrg1yiyjfRvtzaGxZO0+nfeVdUMOqeQgBdQcBYRU+CqfD2BvNV/5pm+sR4qEX79f0xJ3woiTuyIr7Ha7tu3DQDfMvvL+JpL2srlp17ubuD3EmWIAsbCipcN+p9+Kuprddv5QzaY0StGo0y+B0+BZIkTJ6pjwSn1E064CJg7K1AB9xTW1YJkBckRVThWaHSs0JfUcMinmbTQIb+OX9tMglkynvYE3y3dxSkLBPx+9NzTBCoPJaUVCXK7vi/nwLLdKQlHCbYjGsHfF2pjILplryyq3Nfw4dz6E4Sph4xF599uBPjHAKhfy+CaigdwYzLksaRzeBDhQG86Soll9RqgMwnJKionsB+Nr3XjG5eSJDNw8U4ty72v66hc16GeBFhk4iv4sZyVp4ajy3ot+9WATQ7BpBdGjXXfpqZxnsTjYU4WgXI6qJgOJuKiegYQ5ppMx6HUQopaQ1BgO7HXJUcz72c="
